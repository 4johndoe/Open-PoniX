#! /bin/sh
. /etc/ponix.env
. $TS_GLOBAL
RESOLV=/etc/resolv.conf


case $1 in
	deconfig)
		ifconfig $interface 0.0.0.0
		;;
	bound|renew)
	cat /dev/null > $RESOLV
	let i=1
	for dnsserver in $dns ; do
		echo "nameserver $dnsserver" >> $RESOLV
		/bin/store_variable "CLIENT_DNS$i" "$dnsserver" RUNTIME
		let i=i+1
        done

	echo "search $domain" >> $RESOLV
	ifconfig $interface $ip netmask $subnet
	route add default gw $router

	if [ -z "$CLIENT_NAME" ] ; then
		/bin/store_variable CLIENT_NAME "$hostname" RUNTIME
	fi
	if [ -z "$SERVER_NAME" ] ; then
		if [ -n "$tftp" ] ; then
			/bin/store_variable SERVER_NAME "$tftp" RUNTIME
		else
			/bin/store_variable SERVER_NAME "$sname" RUNTIME
		fi
	fi

	/bin/store_variable CLIENT_IP "$ip" RUNTIME
	/bin/store_variable CLIENT_DOMAIN "$domain" RUNTIME
	/bin/store_variable CLIENT_GATEWAY "$router" RUNTIME
	/bin/store_variable NETMASK_SIZE "$mask" RUNTIME
	/bin/store_variable CLIENT_MASK "$subnet" RUNTIME

	# Calculate TimeZone, From Pxes
	#

	if [ -n "$timezone" ]; then
		TZONE="UTC"
		O=$((timezone * -3600))
		[ $O -ge 0 ] && TZONE="${TZONE}+"
		TIME_ZONE="${TZONE}${O}"
		/bin/store_variable TIME_ZONE "$TIME_ZONE" RUNTIME
	fi

	if [ -n "$NET_FILE_ALTERNATE" ] ; then
		SERVER_IP=$NET_FILE_ALTERNATE
	else
		if [ -n "$siaddr" ] ; then
			SERVER_IP=$siaddr
		else
			SERVER_IP=$tftp
		fi
		if [ -z "$SERVER_IP" ] ; then
			SERVER_IP=$serverid
		fi
	fi
	/bin/store_variable SERVER_IP "$SERVER_IP" RUNTIME
	;;
esac
