#!/bin/sh

. $TS_GLOBAL
load_lang config

TMP=/tmp/xdmenu_edit.$$
XDMSGBOX_HEIGHT=32
XDMSGBOX_WIDTH=88

XDMENU_FOCUS_BIN=/bin/xdmenu_focus
FILENAME=$1

if [ "$FILENAME" = "" ] ; then
	echo "Usage: xdmenu_edit file [width] [height]"
	exit
fi

if [ -n "$2" ] ; then
	XDMSGBOX_WIDTH=$2
fi

if [ -n "$3" ] ; then
	XDMSGBOX_HEIGHT=$3
fi

if [ "$DISPLAY" = "" ] ; then
	echo "DISPLAY is not set..."
	exit
fi

CLASSNAME='xdmenu_edit'

# Running Xdialog #####################################

WID=`xdotool search --class "$CLASSNAME"`

if [ "$WID" != "" ] ; then
	xdotool windowkill $WID
fi

$XDMENU_FOCUS_BIN $CLASSNAME &
                                                                
/bin/Xdialog --rc-file /etc/gtkrc.fixedfont --title "$FILENAME" --wmclass $CLASSNAME --stdout --editbox "$FILENAME" $XDMSGBOX_HEIGHT $XDMSGBOX_WIDTH 1>$TMP 2>>$LOGFILE
RET=$?

if [ "$RET" = "0" ] ; then
	cat $TMP > $1
fi

rm $TMP 2>/dev/null

