#!/bin/sh

#
# Start Window Manager JWM if it's not disabled by user
# and make it immune to segfaults
#

. $TS_GLOBAL

if [ "`make_caps "$WM_DISABLE"`" = "ON" ] ; then
	exit 
fi

if [ -n "`pidof jwm`" ] ; then
	echo_log "JWM allready running!"
	exit
fi

check_wm_param()
{
	VALUE="`eval echo '$'$1`"

	if [ -n "$VALUE" ]; then
		if [ "$VALUE" == "$2" ] || [ "$VALUE" == "$3" ] || [ "$VALUE" == "$4" ] ; then
			# value is not empty and one of allowed values. ok
			return
		fi
	fi

	# setting default value
	store_variable $1 $2 RUNTIME
}


check_wm_param WM_TRAY_LAYOUT	vertical	vertical horizontal
check_wm_param WM_TRAY_VALIGN	center		top bottom 
check_wm_param WM_TRAY_HALIGN	left		right center
check_wm_param WM_TRAY_AUTOHIDE	true		false

/bin/replacetpl /etc/system.jwmrc

while [ 1 = 1 ]; do
	/bin/jwm
done

