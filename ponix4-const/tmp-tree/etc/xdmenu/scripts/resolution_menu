#!/bin/sh

. $TS_GLOBAL
load_lang config

MENU_FILE=/tmp/resmenu.xd

echo "
XD_TYPE=MENU
XD_CLASSNAME=resolution_menu
XD_TITLE=\"$LNG_MENU_RESOLUTION_TITLE\"
XD_TEXT=\"$LNG_MENU_RESOLUTION_TEXT\"
XD_WIDTH=54
XD_MENU_EXIT=1
XD_OK_LABEL=\"$LNG_MENU_SELECT_BUTTON\"
XD_CANCEL_LABEL=\"$LNG_MENU_EXIT_BUTTON\"
" > $MENU_FILE


# to create /var/run/xrandr_modes
/bin/apply_xrandr enlist_only

LAST_MON=""

i=0
cat /var/run/xrandr_modes |
while read mon res cur
do
	if [ "$LAST_MON" != "$mon" ] ; then
		echo "XD_ITEM$i=\"$mon\"" >> $MENU_FILE
		echo "XD_INACT$i=\"ON\"" >> $MENU_FILE
		LAST_MON=$mon
		let i=i+1
	fi

#	echo "LINE: res='$res' cur='$cur'"
	if [ -z "`echo $cur | grep \"\*\"`" ] ; then
		echo "XD_ITEM$i=\"$res\"" >> $MENU_FILE
		echo "XD_RUN$i=\"${XDMENU_SCRIPTS}/switch_resolution $mon $res\"" >> $MENU_FILE 
	else
		echo "XD_ITEM$i=\"$res [$LNG_MENU_RESOLUTION_CURRENT]\"" >> $MENU_FILE
	fi

	let i=i+1
done

let i=i+16
echo "XD_HEIGHT=$i" >> $MENU_FILE

/bin/xdmenu $MENU_FILE
rm $MENU_FILE