#!/bin/sh

. $TS_GLOBAL

relist_interfaces()
{
	RES_FILE=$NET_DEVICELIST

	if [ -z "$RES_FILE" ] ; then
		RES_FILE=/tmp/net_interfaces	
		# just in case
	fi
		
	WAS_FIRST=0
	
	cat /dev/null > $RES_FILE

	(ifconfig -a | cut -c1-7 | grep -v '^ *$' | grep -v lo ) |
	while read device
	do
		ifconfig $device up
		devicetype=`echo $device | cut -c1-2`
		if [ "$devicetype" = "tr" ] ; then
			client_mac=`ifconfig -a $device | grep HWaddr | cut -c 37-38,40-41,43-44,46-47,49-50,52-53,55-56,58-59,61-62,64-65,67-68,70-71,73-74,76-77,79-80,82-83`
          	else
              		client_mac=`ifconfig -a $device | grep HWaddr | cut -c 39-40,42-43,45-46,48-49,51-52,54-55`
                fi

                echo $device $client_mac >> $RES_FILE

		if [ "$WAS_FIRST" = "0" ] ; then
			WAS_FIRST=1
			store_variable NET_FIRST_DEVICE "$device" RUNTIME
		fi                
                
	done                  
}

relist_interfaces
cat $RES_FILE
