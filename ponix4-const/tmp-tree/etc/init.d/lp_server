#! /bin/sh

. $TS_GLOBAL

case "$1" in  
init)
    if ! pkg_initialized $PACKAGE; then
        
	let x=0
	PRINTER_X_NAME=$PRINTER_0_NAME

	while [ -n "$PRINTER_X_NAME" ] ; do
		PRINTER_X_DEVICE=`eval echo '$PRINTER_'$x'_DEVICE'`
		PRINTER_X_TYPE=`eval echo '$PRINTER_'$x'_TYPE'`
		PRINTER_X_OPTIONS=`eval echo '$PRINTER_'$x'_OPTIONS'`
	  if [ -n "$PRINTER_X_NAME" ]; then
	    if [ "$PRINTER_X_TYPE" = "S" ]; then
	        echo "Starting lp_server on $PRINTER_X_DEVICE COM or LPT port"
		nohup /bin/lp_immortal -d $PRINTER_X_DEVICE -n 910$x -t "$PRINTER_X_OPTIONS" &
	    else
	        echo "Starting lp_server on $PRINTER_X_DEVICE USB port"
	        nohup /bin/lp_immortal -d $PRINTER_X_DEVICE -n 910$x &
	    fi
	  fi
	  let x=x+1
	  PRINTER_X_NAME=`eval echo '\$PRINTER_'$x'_NAME'`
        done

	pkg_set_init_flag $PACKAGE

    fi

    ;;
help)
    echo "Usage: $0 init"
    ;;
  *)
    exit 1
    ;;
esac

exit 0
