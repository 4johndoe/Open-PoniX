<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>X Access Control Extension Specification</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><meta name="description" content="The X Access Control Extension (XACE) is a set of generic &quot;hooks&quot; that can be used by other X extensions to perform access checks. The goal of XACE is to prevent clutter in the core dix/os code by providing a common mechanism for doing these sorts of checks. The concept is identical to the Linux Security Module (LSM) in the Linux Kernel. XACE version 1.0 was a generalization of the SECURITY extension, which provides a simple on/off trust model where &quot;untrusted&quot; clients are restricted in certain areas. Its hooks were for the most part straight replacements of the old SECURITY logic with generic hook calls. XACE version 2.0 has substantially modified many of the hooks, adding additional parameters and many new access types. Coverage has also been extended to many additional extensions, such as Render and Composite. Finally, there is new support for polyinstantiation, or duplicate, window properties and selections. This paper describes the implementation of XACE version 2.0, changes to the core server DIX and OS layers that have been made or are being considered, and each of the security hooks that XACE offers at the current time and their function. It is expected that changes to XACE be documented here. Please notify the authors of this document of any changes to XACE so that they may be properly documented." /><style xmlns="" type="text/css">/*
 * Copyright (c) 2011 Gaetan Nadon
 * Copyright (c) 2010, Oracle and/or its affiliates. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice (including the next
 * paragraph) shall be included in all copies or substantial portions of the
 * Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 */

/*
 * Shared stylesheet for X.Org documentation translated to HTML format
 * http://www.sagehill.net/docbookxsl/UsingCSS.html
 * http://www.w3schools.com/css/default.asp
 * https://addons.mozilla.org/en-US/firefox/addon/web-developer/developers
 * https://addons.mozilla.org/en-US/firefox/addon/font-finder/
 */

/*
 * The sans-serif fonts are considered more legible on a computer screen
 * http://dry.sailingissues.com/linux-equivalents-verdana-arial.html
 *
 */
body {
  font-family: "Bitstream Vera Sans", "DejaVu Sans", Tahoma, Geneva, Arial, Sans-serif;
  /* In support of using "em" font size unit, the w3c recommended method */
  font-size: 100%;
}

/*
 * Selection: all elements requiring mono spaced fonts.
 *
 * The family names attempt to match the proportionally spaced font
 * family names such that the same font name is used for both.
 * We'd like to use Bitstream, for example, in both proportionally and
 * mono spaced font text.
 */
.command,
.errorcode,
.errorname,
.errortype,
.filename,
.funcsynopsis,
.function,
.parameter,
.programlisting,
.property,
.screen,
.structname,
.symbol,
.synopsis,
.type
{
  font-family:  "Bitstream Vera Sans Mono", "DejaVu Sans Mono", Courier, "Liberation Mono", Monospace;
}

/*
 * Books have a title page, a preface, some chapters and appendices,
 * a glossary, an index and a bibliography, in that order.
 *
 * An Article has no preface and no chapters. It has sections, appendices,
 * a glossary, an index and a bibliography.
 */

/*
 * Selection: book main title and subtitle
 */
div.book>div.titlepage h1.title,
div.book>div.titlepage h2.subtitle {
  text-align: center;
}

/*
 * Selection: article main title and subtitle
 */
div.article>div.titlepage h2.title,
div.article>div.titlepage h3.subtitle,
div.article>div.sect1>div.titlepage h2.title,
div.article>div.section>div.titlepage h2.title {
  text-align: center;
}

/*
 * Selection: various types of authors and collaborators, individuals or corporate
 *
 * These authors are not always contained inside an authorgroup.
 * They can be contained inside a lot of different parent types where they might
 * not be centered.
 * Reducing the margin at the bottom makes a visual separation between authors
 * We specify here the ones on the title page, others may be added based on merit.
 */
div.titlepage .authorgroup,
div.titlepage .author,
div.titlepage .collab,
div.titlepage .corpauthor,
div.titlepage .corpcredit,
div.titlepage .editor,
div.titlepage .othercredit {
  text-align: center;
  margin-bottom: 0.25em;
}

/*
 * Selection: the affiliation of various types of authors and collaborators,
 * individuals or corporate.
 */
div.titlepage .affiliation {
  text-align: center;
}

/*
 * Selection: product release information (X Version 11, Release 7)
 *
 * The releaseinfo element can be contained inside a lot of different parent
 * types where it might not be centered.
 * We specify here the one on the title page, others may be added based on merit.
 */
div.titlepage p.releaseinfo {
  font-weight: bold;
  text-align: center;
}

/*
 * Selection: publishing date
 */
div.titlepage .pubdate {
  text-align: center;
}

/*
 * The legal notices are displayed in smaller sized fonts
 * Justification is only supported in IE and therefore not requested.
 *
 */
.legalnotice {
  font-size: small;
  font-style: italic;
}

/*
 * For documentation having multiple licenses, the copyright and legalnotice
 * elements sequence cannot instantiated multiple times.
 * The copyright notice and license text are therefore coded inside a legalnotice
 * element. The role attribute on the paragraph is used to allow styling of the
 * copyright notice text which should not be italicized.
 */
p.multiLicensing {
  font-style: normal;
  font-size: medium;
}

/*
 * Selection: book or article main ToC title
 * A paragraph is generated for the title rather than a level 2 heading.
 * We do not want to select chapters sub table of contents, only the main one
 */
div.book>div.toc>p,
div.article>div.toc>p {
  font-size: 1.5em;
  text-align: center;
}

/*
 * Selection: major sections of a book or an article
 *
 * Unlike books, articles do not have a titlepage element for appendix.
 * Using the selector "div.titlepage h2.title" would be too general.
 */
div.book>div.preface>div.titlepage h2.title,
div.book>div.chapter>div.titlepage h2.title,
div.article>div.sect1>div.titlepage h2.title,
div.article>div.section>div.titlepage h2.title,
div.book>div.appendix>div.titlepage h2.title,
div.article>div.appendix h2.title,
div.glossary>div.titlepage h2.title,
div.index>div.titlepage h2.title,
div.bibliography>div.titlepage h2.title {
   /* Add a border top over the major parts, just like printed books */
   /* The Gray color is already used for the ruler over the main ToC. */
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: Gray;
  /* Put some space between the border and the title */
  padding-top: 0.2em;
  text-align: center;
}

/*
 * A Screen is a verbatim environment for displaying text that the user might
 * see on a computer terminal. It is often used to display the results of a command.
 *
 * http://www.css3.info/preview/rounded-border/
 */
.screen {
  background: #e0ffff;
  border-width: 1px;
  border-style: solid;
  border-color: #B0C4DE;
  border-radius: 1.0em;
  /* Browser's vendor properties prior to CSS 3 */
  -moz-border-radius: 1.0em;
  -webkit-border-radius: 1.0em;
  -khtml-border-radius: 1.0em;
  margin-left: 1.0em;
  margin-right: 1.0em;
  padding: 0.5em;
}

/*
 * Emphasis program listings with a light shade of gray similar to what
 * DocBook XSL guide does: http://www.sagehill.net/docbookxsl/ProgramListings.html
 * Found many C API docs on the web using like shades of gray.
 */
.programlisting {
  background: #F4F4F4;
  border-width: 1px;
  border-style: solid;
  border-color: Gray;
  padding: 0.5em;
}

/*
 * Emphasis functions synopsis using a darker shade of gray.
 * Add a border such that it stands out more.
 * Set the padding so the text does not touch the border.
 */
.funcsynopsis, .synopsis {
  background: #e6e6fa;
  border-width: 1px;
  border-style: solid;
  border-color: Gray;
  clear: both;
  margin: 0.5em;
  padding: 0.25em;
}

/*
 * Selection: paragraphs inside synopsis
 *
 * Removes the default browser margin, let the container set the padding.
 * Paragraphs are not always used in synopsis
 */
.funcsynopsis p,
.synopsis p {
  margin: 0;
  padding: 0;
}

/*
 * Selection: variable lists, informal tables and tables
 *
 * Note the parameter name "variablelist.as.table" in xorg-xhtml.xsl
 * A table with rows and columns is constructed inside div.variablelist
 *
 * Set the left margin so it is indented to the right
 * Display informal tables with single line borders
 */
table {
  margin-left: 0.5em;
  border-collapse: collapse;
}

/*
 * Selection: paragraphs inside tables
 *
 * Removes the default browser margin, let the container set the padding.
 * Paragraphs are not always used in tables
 */
td p {
  margin: 0;
  padding: 0;
}

/*
 * Add some space between the left and right column.
 * The vertical alignment helps the reader associate a term
 * with a multi-line definition.
 */
td, th {
  padding-left: 1.0em;
  padding-right: 1.0em;
  vertical-align: top;
}

.warning {
  border: 1px solid red;
  background: #FFFF66;
  padding-left: 0.5em;
}
</style></head><body><div class="article" title="X Access Control Extension Specification"><div class="titlepage"><div><div><h2 class="title"><a id="id2625960"></a>X Access Control Extension Specification</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Eamon</span> <span class="othername">F.</span> <span class="surname">Walsh</span></h3></div></div><div><p class="releaseinfo">X Version 11, Release 7.7</p></div><div><div class="legalnotice" title="Legal Notice"><a id="id2651159"></a><p>
    Permission is hereby granted, free of charge, to any person obtaining a
    copy of this software and associated documentation files (the "Software"),
    to deal in the Software without restriction, including without limitation
    the rights to use, copy, modify, merge, publish, distribute, sublicense,
    and/or sell copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following conditions:
    </p><p>
    The above copyright notice and this permission notice (including the next
    paragraph) shall be included in all copies or substantial portions of the
    Software.
    </p><p>
    THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
    DEALINGS IN THE SOFTWARE.
    </p></div></div><div><p class="pubdate">2009</p></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><strong>Revision History</strong></th></tr><tr><td align="left">Revision 1.0</td><td align="left">19 Oct 2006</td><td align="left">efw</td></tr><tr><td align="left" colspan="3">Initial Version</td></tr><tr><td align="left">Revision 2.0</td><td align="left">10 Mar 2008</td><td align="left">efw</td></tr><tr><td align="left" colspan="3">Version 2.0</td></tr><tr><td align="left">Revision 2.1</td><td align="left">19 Jun 2009</td><td align="left">efw</td></tr><tr><td align="left" colspan="3">Version 2.1 (XI2)</td></tr><tr><td align="left">Revision 2.2</td><td align="left">29 Jun 2009</td><td align="left">efw</td></tr><tr><td align="left" colspan="3">Version 2.2 (Property post-data hook)</td></tr></table></div></div><div><div class="abstract" title="Abstract"><p>The X Access Control Extension (XACE) is a set of generic "hooks" that can be used by other X extensions to perform access checks. The goal of XACE is to prevent clutter in the core dix/os code by providing a common mechanism for doing these sorts of checks. The concept is identical to the Linux Security Module (LSM) in the Linux Kernel.</p><p>XACE version 1.0 was a generalization of the SECURITY extension, which provides a simple on/off trust model where "untrusted" clients are restricted in certain areas.  Its hooks were for the most part straight replacements of the old SECURITY logic with generic hook calls.  XACE version 2.0 has substantially modified many of the hooks, adding additional parameters and many new access types.  Coverage has also been extended to many additional extensions, such as Render and Composite.  Finally, there is new support for polyinstantiation, or duplicate, window properties and selections.</p><p>This paper describes the implementation of XACE version 2.0, changes to the core server DIX and OS layers that have been made or are being considered, and each of the security hooks that XACE offers at the current time and their function.  It is expected that changes to XACE be documented here.  Please notify the authors of this document of any changes to XACE so that they may be properly documented.</p></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="#id2625259">Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#id2625264">Prerequisites</a></span></dt><dt><span class="section"><a href="#id2625279">Purpose</a></span></dt><dt><span class="section"><a href="#id2625359">Prior Work</a></span></dt><dt><span class="section"><a href="#id2625412">Version 2.0 Changes</a></span></dt><dt><span class="section"><a href="#id2626574">Future Work</a></span></dt></dl></dd><dt><span class="section"><a href="#id2626642">Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#id2626648">Storing Security State</a></span></dt><dt><span class="section"><a href="#id2626693">Using Hooks</a></span></dt></dl></dd><dt><span class="section"><a href="#id2686064">Protocol</a></span></dt><dd><dl><dt><span class="section"><a href="#id2686070">Requests</a></span></dt><dt><span class="section"><a href="#id2686080">Events</a></span></dt><dt><span class="section"><a href="#id2686091">Errors</a></span></dt></dl></dd></dl></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2625259"></a>Introduction</h2></div></div></div><div class="section" title="Prerequisites"><div class="titlepage"><div><div><h3 class="title"><a id="id2625264"></a>Prerequisites</h3></div></div></div><p>This document is targeted to programmers who are writing security extensions for X.  It is assumed that the reader is familiar with the C programming language.  It is assumed that the reader understands the general workings of the X protocol and X server.</p></div><div class="section" title="Purpose"><div class="titlepage"><div><div><h3 class="title"><a id="id2625279"></a>Purpose</h3></div></div></div><p>XACE makes it easier to implement new security models for X by providing a set of pluggable hooks that extension writers can use.  The idea is to provide an abstraction layer between security extensions and the core DIX/OS code of the X server.  This prevents security extensions writers from having to understand the inner workings of the X server and it prevents X server maintainers from having to deal with multiple security subsystems, each with its own intrusive code.</p><p>For example, consider the X.Org X server's resource subsystem, which is used to track different types of server objects using ID numbers.  The act of looking up an object by its ID number is a security-relevant operation which security extension writers would likely wish to control.  For one or two security extensions it may be acceptable to simply insert the extension's code directly into the resource manager code, bracketed by <code class="literal">ifdef</code>'s.  However for more extensions this approach leads to a tangle of code, particularly when results need to be logically combined, as in <code class="literal">if</code> statement conditions.  Additionally, different extension writers might place their resource checking code in different places in the server, leading to difficulty in tracking down where exactly a particular lookup operation is being blocked.  Finally, this approach may lead to unexpected interactions between the code of different extensions, since there is no collaboration between extension writers.</p><p>The solution employed by the X Access Control Extension is to place hooks (calls into XACE) at security-relevant places, such as the resource subsystem mentioned above.  Other extensions, typically in their initialization routines, can register callback functions on these hooks.  When the hook is called from the server code, each callback function registered on it is called in turn.  The callback function is provided with necessary arguments needed to make a security decision, including a return value argument which can be set to indicate the result.  XACE itself does not make security decisions, or even know or care how such decisions are made.  XACE merely enforces the result of the decision, such as by returning a <span class="errorname">BadAccess</span> error to the requesting client.</p><p>This separation between the decision-making logic and the enforcement logic is advantageous because it allows a great variety of security models to be developed without resorting to intrusive modifications to the core systems being secured.  The challenge is to ensure that the hook framework itself provides hooks everywhere they need to be provided.  Once created, however, a hook can be used by everyone, leading to less duplication of effort.</p></div><div class="section" title="Prior Work"><div class="titlepage"><div><div><h3 class="title"><a id="id2625359"></a>Prior Work</h3></div></div></div><div class="section" title="Security Extension"><div class="titlepage"><div><div><h4 class="title"><a id="id2625364"></a>Security Extension</h4></div></div></div><p>XACE was initially based on the SECURITY extension.  This extension introduced the concept of "trusted" and "untrusted" client connections, with the trust level established by the authorization token used in the initial client connection.  Untrusted clients are restricted in several areas, notably in the use of background "None" windows, access to server resources owned by trusted clients, and certain keyboard input operations.  Server extensions are also declared "trusted" or "untrusted," with only untrusted extensions being visible to untrusted client connections.</p></div><div class="section" title="Solaris Trusted Extensions"><div class="titlepage"><div><div><h4 class="title"><a id="id2625384"></a>Solaris Trusted Extensions</h4></div></div></div><p>Trusted Extensions for Solaris has an X extension (Xtsol) which adds security functionality.  Some of the XACE hooks in the current set were derived from security checks made by the Xtsol code.  In other places, where the Xtsol and SECURITY extensions both have checks, a single XACE hook replaces both.</p></div><div class="section" title="Linux Security Modules"><div class="titlepage"><div><div><h4 class="title"><a id="id2625399"></a>Linux Security Modules</h4></div></div></div><p>XACE is influenced by the Linux Security Modules project, which provides a similar framework of security hooks for the Linux kernel.</p></div></div><div class="section" title="Version 2.0 Changes"><div class="titlepage"><div><div><h3 class="title"><a id="id2625412"></a>Version 2.0 Changes</h3></div></div></div><div class="section" title="Different Return-Value Semantics"><div class="titlepage"><div><div><h4 class="title"><a id="changes_status"></a>Different Return-Value Semantics</h4></div></div></div><p>The status value returned by security modules has been changed.  Formerly, security modules were expected to set the "rval" field of the input structure to "False" if access was to be denied.  In version 2.0, this field has been removed in all hooks.  Security modules must now set the "status" field to an X error code to describe the error.  Typically, <code class="literal">BadAccess</code> will be returned, but this change allows security modules to return <code class="literal">BadAlloc</code> to report memory allocation failure and <code class="literal">BadMatch</code> to report a polyinstantiated object lookup failure (<a class="xref" href="#changes_poly" title="Polyinstantiation">the section called “Polyinstantiation”</a>).</p></div><div class="section" title="DevPrivates Mechanism"><div class="titlepage"><div><div><h4 class="title"><a id="changes_privates"></a>DevPrivates Mechanism</h4></div></div></div><p>The devPrivates mechanism in the X server was substantially revised to better support security extensions.  The interface for using devPrivates has been unified across the different structures that support private data.  Private space allocation is now independent of whether objects have already been created, and the private indexes are now global rather than being structure specific.  Callbacks are available to initialize newly allocated space and to clean up before it is freed.  Finally, there is a mechanism for looking up the offset of the private pointer field in a structure, given the structure's resource type.</p></div><div class="section" title="New Access Modes"><div class="titlepage"><div><div><h4 class="title"><a id="changes_modes"></a>New Access Modes</h4></div></div></div><p>In the previous version, there were four possible modes for the "access_mode" field: read, write, create, and destroy.  In version 2.0, many new modes have been introduced to better describe X operations, particularly on window objects.  The access_mode field has also been added to additional hooks as described in the individual hook changes.</p></div><div class="section" title="Polyinstantiation"><div class="titlepage"><div><div><h4 class="title"><a id="changes_poly"></a>Polyinstantiation</h4></div></div></div><p>XACE now supports polyinstantiation of selections and window properties.  <a class="xref" href="#property_access_hook" title="Property Access">the section called “Property Access”</a> and <a class="xref" href="#selection_access_hook" title="Selection Access">the section called “Selection Access”</a> describe the details, but the basic idea is that the property and selection access hooks may be used to not only change the return value of a lookup operation but also to modify the lookup result.  This allows more than one property or selection with the same atom name to be maintained.</p></div><div class="section" title="Removed Hooks"><div class="titlepage"><div><div><h4 class="title"><a id="changes_removed"></a>Removed Hooks</h4></div></div></div><p>The "drawable," "map," "window init", and "background" hooks have been removed.  They have been folded into the resource access hook using new access modes.  The "hostlist" hook has been removed and replaced by a new server access hook (see <a class="xref" href="#server_access_hook" title="Server Access">the section called “Server Access”</a>).  The "site policy" and "declare extension security" hooks have been removed as the SECURITY extension has been revised to no longer require them.</p></div><div class="section" title="New Hooks"><div class="titlepage"><div><div><h4 class="title"><a id="changes_new"></a>New Hooks</h4></div></div></div><p>New "send" and "receive" hooks have been added to allow basic control over event delivery.  "Client" and "server" access hooks have been added to control access by clients to other clients (for example, through the <code class="literal">KillClient</code> call) and to the server (for example when changing the host access list or changing the font path).  "Screen" and "screen saver" hooks have been added to control access to screens and screen saver requests.  A "selection" hook has been added to control access to selections.</p></div><div class="section" title="Changes to Existing Hooks"><div class="titlepage"><div><div><h4 class="title"><a id="changes_existing"></a>Changes to Existing Hooks</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The resource access hook structure now has additional fields to describe a "parent" object.  They are set only when a resource with a defined parent (such as a Window object) is being created, in which case the access mode will include <code class="literal">DixCreateAccess</code>.</p></li><li class="listitem"><p>The device access hook structure has had the "fromRequest" field removed and an access mode field added.</p></li><li class="listitem"><p>The property access hook structure has had the "propertyName" field removed and a "ppProp" field added, which contains a pointer to a pointer to the property structure itself.  The extra level of indirection supports polyinstantiation (see <a class="xref" href="#changes_poly" title="Polyinstantiation">the section called “Polyinstantiation”</a>).  Note that the property structure contains the property name.</p></li><li class="listitem"><p>The extension dispatch/access hook structure now has an access mode field.</p></li></ul></div></div></div><div class="section" title="Future Work"><div class="titlepage"><div><div><h3 class="title"><a id="id2626574"></a>Future Work</h3></div></div></div><div class="section" title="Security Hooks"><div class="titlepage"><div><div><h4 class="title"><a id="future_hooks"></a>Security Hooks</h4></div></div></div><p>It is anticipated that the set of security hooks provided by XACE will change with time.  Some hooks may become deprecated.  More hooks will likely be added as well, as more portions of the X server are subjected to security analysis.  Existing hooks may be added in more places in the code, particularly protocol extensions.  Currently, the only method XACE provides for restricting access to some protocol extensions is to deny access to them entirely.</p><p>It should be noted that XACE includes hooks in the protocol dispatch table, which allow a security extension to examine any incoming protocol request (core or extension) and terminate the request before it is handled by the server.  This functionality can be used as a stopgap measure for security checks that are not supported by the other XACE hooks.  The end goal, however, is to have hooks integrated into the server proper.</p></div><div class="section" title="Core X Server"><div class="titlepage"><div><div><h4 class="title"><a id="future_core"></a>Core X Server</h4></div></div></div><p>The set of extensions supported by X.org needs to be re-examined.  Many of them are essentially unused and removing them would be easier than attempting to secure them.  The GLX extension and the direct rendering kernel interfaces need to be secured.</p><p>The server's routines for event delivery need to be reworked to allow greater control by XACE modules.  In particular, security extensions need to be able to associate private data with each event at the time of its generation based on the context and then have that data available at a decision point just before the event is delivered to the client.  This would allow event delivery to be better controlled on a per-client basis, and would potentially allow additional security extension functionality such as piggyback events.</p></div></div></div><div class="section" title="Usage"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2626642"></a>Usage</h2></div></div></div><div class="section" title="Storing Security State"><div class="titlepage"><div><div><h3 class="title"><a id="id2626648"></a>Storing Security State</h3></div></div></div><p>The first thing you, the security extension writer, should decide on is the state information that your extension will be storing and how it will be stored.  XACE itself does not provide any mechanism for storing state.</p><p>One method of storing state is global variables in the extension code.  Tables can be kept corresponding to internal server structures, updated to stay synchronized with the structures themselves.  One problem with this method is that the X server does not have consistent methods for lifecycle management of its objects, meaning that it might be difficult to keep state up to date with objects.</p><p>Another method of storing state is to attach your extension's security data directly to the server structures.  This method is possible via the <code class="literal">devPrivates</code> mechanism provide by the DIX layer.  Structures supporting this mechanism can be identified by the presence of a "devPrivates" field.  Full documentation of the devPrivates mechanism is described in the core X server documentation.</p></div><div class="section" title="Using Hooks"><div class="titlepage"><div><div><h3 class="title"><a id="id2626693"></a>Using Hooks</h3></div></div></div><div class="section" title="Overview"><div class="titlepage"><div><div><h4 class="title"><a id="id2626699"></a>Overview</h4></div></div></div><p>XACE has two header files that security extension code may need to include.  Include <code class="filename">Xext/xacestr.h</code> if you need the structure definitions for the XACE hooks in your source file.  Otherwise, include <code class="filename">Xext/xace.h</code>, which contains everything else including constants and function declarations.</p><p>XACE hooks use the standard X server callback mechanism.  Your security extension's callback functions should all use the following prototype:
	</p><div class="blockquote"><blockquote class="blockquote"><div class="funcsynopsis"><p><code class="funcdef">void <strong>fsfuncMyCallback</strong>(</code>
	      <var class="pdparam">CallbackListPtr *pcbl</var>
	      <var class="pdparam">pointer userdata</var>
	      <var class="pdparam">pointer calldata</var>
	    <code>)</code>;</p></div></blockquote></div><p>
	When the callback is called, <em class="parameter"><code>pcbl</code></em> points to the callback list itself.  The X callback mechanism allows the list to be manipulated in various ways, but XACE callbacks should not do this.  Remember that other security extensions may be registered on the same hook.  <em class="parameter"><code>userdata</code></em> is set to the data argument that was passed to <a class="xref" href="#XaceRegisterCallback"><code class="function">XaceRegisterCallback</code></a> at registration time; this can be used by your extension to pass data into the callback.  <em class="parameter"><code>calldata</code></em> points to a value or structure which is specific to each XACE hook.  These are discussed in the documentation for each specific hook, below.  Your extension must cast this argument to the appropriate pointer type.</p><p>To register a callback on a given hook, use <a class="xref" href="#XaceRegisterCallback"><code class="function">XaceRegisterCallback</code></a>:
	</p><div class="blockquote"><blockquote class="blockquote"><div class="funcsynopsis"><p><code class="funcdef">Bool <strong>fsfuncXaceRegisterCallback</strong>(</code>
	      <var class="pdparam">int hook</var>
	      <var class="pdparam">CallbackProcPtr callback</var>
	      <var class="pdparam">pointer userdata</var>
	    <code>)</code>;</p></div></blockquote></div><p>
	Where <em class="parameter"><code>hook</code></em> is the XACE hook you wish to register on, <em class="parameter"><code>callback</code></em> is the callback function you wish to register, and <em class="parameter"><code>userdata</code></em> will be passed through to the callback as its second argument, as described above.  See <a class="xref" href="#hooks_tab" title="Table 1. XACE security hooks.">Table 1, “XACE security hooks.”</a> for the list of XACE hook codes.  <a class="xref" href="#XaceRegisterCallback"><code class="function">XaceRegisterCallback</code></a> is typically called from the extension initialization code; see the SECURITY source for examples.  The return value is <code class="literal">TRUE</code> for success, <code class="literal">FALSE</code> otherwise.</p><p>To unregister a callback, use <a class="xref" href="#XaceDeleteCallback"><code class="function">XaceDeleteCallback</code></a>:
	</p><div class="blockquote"><blockquote class="blockquote"><div class="funcsynopsis"><p><code class="funcdef">Bool <strong>fsfuncXaceDeleteCallback</strong>(</code>
	      <var class="pdparam">int hook</var>
	      <var class="pdparam">CallbackProcPtr callback</var>
	      <var class="pdparam">pointer userdata</var>
	    <code>)</code>;</p></div></blockquote></div><p>
	where the three arguments are identical to those used in the call to <a class="xref" href="#XaceRegisterCallback"><code class="function">XaceRegisterCallback</code></a>.  The return value is <code class="literal">TRUE</code> for success, <code class="literal">FALSE</code> otherwise.</p></div><div class="section" title="Hooks"><div class="titlepage"><div><div><h4 class="title"><a id="id2682343"></a>Hooks</h4></div></div></div><p>The currently defined set of XACE hooks is shown in <a class="xref" href="#hooks_tab" title="Table 1. XACE security hooks.">Table 1, “XACE security hooks.”</a>.  As discussed in <a class="xref" href="#future_hooks" title="Security Hooks">the section called “Security Hooks”</a>, the set of hooks is likely to change in the future as XACE is adopted and further security analysis of the X server is performed.</p><div class="table"><a id="hooks_tab"></a><p class="title"><strong>Table 1. XACE security hooks.</strong></p><div class="table-contents"><table summary="XACE security hooks." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Hook Identifier</th><th align="left">Callback Argument Type</th><th align="left">Refer to</th></tr></thead><tbody><tr><td align="left"><code class="literal">XACE_CORE_DISPATCH</code></td><td align="left"><span class="type">XaceCoreDispatchRec</span></td><td align="left"><a class="xref" href="#core_dispatch_hook" title="Core Dispatch">the section called “Core Dispatch”</a></td></tr><tr><td align="left"><code class="literal">XACE_EXT_DISPATCH</code></td><td align="left"><span class="type">XaceExtAccessRec</span></td><td align="left"><a class="xref" href="#ext_dispatch_hook" title="Extension Dispatch">the section called “Extension Dispatch”</a></td></tr><tr><td align="left"><code class="literal">XACE_RESOURCE_ACCESS</code></td><td align="left"><span class="type">XaceResourceAccessRec</span></td><td align="left"><a class="xref" href="#resource_access_hook" title="Resource Access">the section called “Resource Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_DEVICE_ACCESS</code></td><td align="left"><span class="type">XaceDeviceAccessRec</span></td><td align="left"><a class="xref" href="#device_access_hook" title="Device Access">the section called “Device Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_PROPERTY_ACCESS</code></td><td align="left"><span class="type">XacePropertyAccessRec</span></td><td align="left"><a class="xref" href="#property_access_hook" title="Property Access">the section called “Property Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_SEND_ACCESS</code></td><td align="left"><span class="type">XaceSendAccessRec</span></td><td align="left"><a class="xref" href="#send_access_hook" title="Send Access">the section called “Send Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_RECEIVE_ACCESS</code></td><td align="left"><span class="type">XaceReceiveAccessRec</span></td><td align="left"><a class="xref" href="#receive_access_hook" title="Receive Access">the section called “Receive Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_CLIENT_ACCESS</code></td><td align="left"><span class="type">XaceClientAccessRec</span></td><td align="left"><a class="xref" href="#client_access_hook" title="Client Access">the section called “Client Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_EXT_ACCESS</code></td><td align="left"><span class="type">XaceExtAccessRec</span></td><td align="left"><a class="xref" href="#ext_access_hook" title="Extension Access">the section called “Extension Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_SERVER_ACCESS</code></td><td align="left"><span class="type">XaceServerAccessRec</span></td><td align="left"><a class="xref" href="#server_access_hook" title="Server Access">the section called “Server Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_SELECTION_ACCESS</code></td><td align="left"><span class="type">XaceSelectionAccessRec</span></td><td align="left"><a class="xref" href="#selection_access_hook" title="Selection Access">the section called “Selection Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_SCREEN_ACCESS</code></td><td align="left"><span class="type">XaceScreenAccessRec</span></td><td align="left"><a class="xref" href="#screen_access_hook" title="Screen Access">the section called “Screen Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_SCREENSAVER_ACCESS</code></td><td align="left"><span class="type">XaceScreenAccessRec</span></td><td align="left"><a class="xref" href="#screensaver_access_hook" title="Screen Saver Access">the section called “Screen Saver Access”</a></td></tr><tr><td align="left"><code class="literal">XACE_AUTH_AVAIL</code></td><td align="left"><span class="type">XaceAuthAvailRec</span></td><td align="left"><a class="xref" href="#auth_avail_hook" title="Authorization Availability Hook">the section called “Authorization Availability Hook”</a></td></tr><tr><td align="left"><code class="literal">XACE_KEY_AVAIL</code></td><td align="left"><span class="type">XaceKeyAvailRec</span></td><td align="left"><a class="xref" href="#key_avail_hook" title="Keypress Availability Hook">the section called “Keypress Availability Hook”</a></td></tr><tr><td align="left"><code class="literal">XACE_AUDIT_BEGIN</code></td><td align="left"><span class="type">XaceAuditRec</span></td><td align="left"><a class="xref" href="#audit_avail_hook" title="Auditing Hooks">the section called “Auditing Hooks”</a></td></tr><tr><td align="left"><code class="literal">XACE_AUDIT_END</code></td><td align="left"><span class="type">XaceAuditRec</span></td><td align="left"><a class="xref" href="#audit_avail_hook" title="Auditing Hooks">the section called “Auditing Hooks”</a></td></tr></tbody></table></div></div><br class="table-break" /><p>In the descriptions that follow, it is helpful to have a listing of <code class="filename">Xext/xacestr.h</code> available for reference.</p><div class="section" title="Core Dispatch"><div class="titlepage"><div><div><h5 class="title"><a id="core_dispatch_hook"></a>Core Dispatch</h5></div></div></div><p>This hook allows security extensions to examine all incoming core protocol requests before they are dispatched.  The hook argument is a pointer to a structure of type <span class="type">XaceCoreDispatchRec</span>.  This structure contains a
	  <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>
	  and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client making the incoming request.  Note that the complete request is accessible via the <em class="structfield"><code>requestBuffer</code></em> member of the client structure.  The <code class="function">REQUEST</code> family of macros, located in <code class="filename">include/dix.h</code>, are useful in verifying and reading from this member.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the request will not be processed further and the error code will be returned to the client.</p></div><div class="section" title="Extension Dispatch"><div class="titlepage"><div><div><h5 class="title"><a id="ext_dispatch_hook"></a>Extension Dispatch</h5></div></div></div><p>This hook allows security extensions to examine all incoming extension protocol requests before they are dispatched.  The hook argument is a pointer to a structure of type <span class="type">XaceExtAccessRec</span>.  This structure contains a
	  <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	  a <em class="structfield"><code>ext</code></em> field of type <span class="type">ExtensionEntry*</span>,
	  a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	  and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client making the incoming request.  Note that the complete request is accessible via the <em class="structfield"><code>requestBuffer</code></em> member of the client structure.  The <code class="function">REQUEST</code> family of macros, located in <code class="filename">include/dix.h</code>, are useful in verifying and reading from this member.</p><p>The <em class="structfield"><code>ext</code></em> field refers to the extension being accessed.  This is required information since extensions are not associated with any particular major number.</p><p>The <em class="structfield"><code>access_mode</code></em> field is set to <code class="literal">DixUseAccess</code> when this hook is exercised.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the request will not be processed further and the error code will be returned to the client.</p></div><div class="section" title="Resource Access"><div class="titlepage"><div><div><h5 class="title"><a id="resource_access_hook"></a>Resource Access</h5></div></div></div><p>This hook allows security extensions to monitor all resource lookups.  The hook argument is a pointer to a structure of type <span class="type">XaceResourceAccessRec</span>.  This structure contains a
	  <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	  a <em class="structfield"><code>id</code></em> field of type <span class="type">XID</span>,
	  a <em class="structfield"><code>rtype</code></em> field of type <span class="type">RESTYPE</span>,
	  a <em class="structfield"><code>res</code></em> field of type <span class="type">pointer</span>,
	  a <em class="structfield"><code>ptype</code></em> field of type <span class="type">RESTYPE</span>,
	  a <em class="structfield"><code>parent</code></em> field of type <span class="type">pointer</span>,
	  a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	  and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client on whose behalf the lookup is being performed.  Note that this may be <code class="varname">serverClient</code> for server lookups.</p><p>The <em class="structfield"><code>id</code></em> field is the resource ID being looked up.</p><p>The <em class="structfield"><code>rtype</code></em> field is the type of the resource being looked up.</p><p>The <em class="structfield"><code>res</code></em> field is the resource itself: the result of the lookup.</p><p>The <em class="structfield"><code>ptype</code></em> field is the type of the parent resource or RT_NONE if not set.</p><p>The <em class="structfield"><code>parent</code></em> field is the parent resource itself or NULL if not set.  The parent resource is set only when two conditions are met: The resource in question is being created at the time of the call (in which case the <em class="structfield"><code>access_mode</code></em> will include <code class="literal">DixCreateAccess</code>) and the resource in question has a defined parent object. <a class="xref" href="#resource_access_parents" title="Table 3. Resource access hook parent objects.">Table 3, “Resource access hook parent objects.”</a> lists the resources that support parent objects.  The purpose of these two fields is to provide generic support for "parent" resources.</p><p>The <em class="structfield"><code>access_mode</code></em> field encodes the type of action being performed.  The valid mode bits are defined in <code class="filename">include/dixaccess.h</code>.  The meaning of the bits depends on the specific resource type.  Tables for some common types can be found in <a class="xref" href="#resource_access_modes" title="Table 2. Resource access hook access modes.">Table 2, “Resource access hook access modes.”</a>.  Note that the <code class="literal">DixCreateAccess</code> access mode has special meaning: it signifies that the resource object is in the process of being created.  This provides an opportunity for the security extension to initialize its security label information in the structure devPrivates or otherwise.  If the status field is set to an error code in this case, the resource creation will fail and no entry will be made under the specified resource ID.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the resource lookup will fail and an error (usually, but not always, the status value) will be returned to the client.</p><div class="table"><a id="resource_access_modes"></a><p class="title"><strong>Table 2. Resource access hook access modes.</strong></p><div class="table-contents"><table summary="Resource access hook access modes." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Access Mode Bit</th><th align="left">Meaning</th><th align="left">Example Call Site</th></tr></thead><tbody><tr><td align="left"><code class="literal">DixReadAccess</code></td><td align="left">The primary data or contents of the object are being read (drawables, cursors, colormaps).</td><td align="left">GetImage, GetCursorImage, CreatePicture, QueryColors</td></tr><tr><td align="left"><code class="literal">DixWriteAccess</code></td><td align="left">The primary data or contents of the object are being written (drawables, cursors, colormaps).</td><td align="left">PutImage, RenderTriFan, ClearArea, StoreColors, RecolorCursor</td></tr><tr><td align="left"><code class="literal">DixDestroyAccess</code></td><td align="left">The object is being removed.</td><td align="left">CloseFont, DestroyWindow, FreePixmap, FreeCursor, RenderFreePicture</td></tr><tr><td align="left"><code class="literal">DixCreateAccess</code></td><td align="left">The object is being created.</td><td align="left">CreateWindow, CreatePixmap, CreateGC, CreateColormap</td></tr><tr><td align="left"><code class="literal">DixGetAttrAccess</code></td><td align="left">The object's attributes are being queried, or the object is being referenced.</td><td align="left">GetWindowAttributes, GetGeometry, QueryFont, CopyGC, QueryBestSize</td></tr><tr><td align="left"><code class="literal">DixSetAttrAccess</code></td><td align="left">The object's attributes are being changed.</td><td align="left">SetWindowAttributes, ChangeGC, SetClipRectangles, XFixesSetCursorName</td></tr><tr><td align="left"><code class="literal">DixListPropAccess</code></td><td align="left">User properties set on the object are being listed (windows).</td><td align="left">ListProperties</td></tr><tr><td align="left"><code class="literal">DixGetPropAccess</code></td><td align="left">A user property set on the object is being read (windows).</td><td align="left">GetProperty, RotateProperties</td></tr><tr><td align="left"><code class="literal">DixSetPropAccess</code></td><td align="left">A user property set on the object is being written (windows).</td><td align="left">ChangeProperty, RotateProperties, DeleteProperty</td></tr><tr><td align="left"><code class="literal">DixListAccess</code></td><td align="left">Child objects of the object are being listed out (windows).</td><td align="left">QueryTree, MapSubwindows, UnmapSubwindows</td></tr><tr><td align="left"><code class="literal">DixAddAccess</code></td><td align="left">A child object is being added to the object (drawables, fonts, colormaps).</td><td align="left">CreateWindow, ReparentWindow, AllocColor, RenderCreatePicture, RenderAddGlyphs</td></tr><tr><td align="left"><code class="literal">DixRemoveAccess</code></td><td align="left">A child object is being removed from object (drawables, fonts, colormaps).</td><td align="left">DestroyWindow, ReparentWindow, FreeColors, RenderFreeGlyphs</td></tr><tr><td align="left"><code class="literal">DixHideAccess</code></td><td align="left">Object is being unmapped or hidden from view (drawables, cursor).</td><td align="left">UnmapWindow, XFixesHideCursor</td></tr><tr><td align="left"><code class="literal">DixShowAccess</code></td><td align="left">Object is being mapped or shown (drawables, cursor).</td><td align="left">MapWindow, XFixesShowCursor</td></tr><tr><td align="left"><code class="literal">DixBlendAccess</code></td><td align="left">Drawable contents are being mixed in a way that may compromise contents.</td><td align="left">Background "None", CompositeRedirectWindow, CompositeRedirectSubwindows</td></tr><tr><td align="left"><code class="literal">DixGrabAccess</code></td><td align="left">Override-redirect bit on a window has been set.</td><td align="left">CreateWindow, ChangeWindowAttributes</td></tr><tr><td align="left"><code class="literal">DixInstallAccess</code></td><td align="left">Colormap is being installed.</td><td align="left">InstallColormap</td></tr><tr><td align="left"><code class="literal">DixUninstallAccess</code></td><td align="left">Colormap is being uninstalled.</td><td align="left">UninstallColormap</td></tr><tr><td align="left"><code class="literal">DixSendAccess</code></td><td align="left">An event is being sent to a window.</td><td align="left">SendEvent</td></tr><tr><td align="left"><code class="literal">DixReceiveAccess</code></td><td align="left">A client is setting an event mask on a window.</td><td align="left">ChangeWindowAttributes, XiSelectExtensionEvent</td></tr><tr><td align="left"><code class="literal">DixUseAccess</code></td><td align="left">The object is being used without modifying it (fonts, cursors, gc).</td><td align="left">CreateWindow, FillPoly, GrabButton, ChangeGC</td></tr><tr><td align="left"><code class="literal">DixManageAccess</code></td><td align="left">Window-manager type actions on a drawable.</td><td align="left">CirculateWindow, ChangeSaveSet, ReparentWindow</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="resource_access_parents"></a><p class="title"><strong>Table 3. Resource access hook parent objects.</strong></p><div class="table-contents"><table summary="Resource access hook parent objects." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Resource Type</th><th align="left">Parent Resource Type</th><th align="left">Notes</th></tr></thead><tbody><tr><td align="left"><code class="literal">RT_WINDOW</code></td><td align="left"><code class="literal">RT_WINDOW</code></td><td align="left">Contains the parent window.  This will be NULL for root windows.</td></tr><tr><td align="left"><code class="literal">RT_PIXMAP</code></td><td align="left"><code class="literal">RT_WINDOW</code></td><td align="left">COMPOSITE extension only: the source window is passed as the parent for redirect pixmaps.</td></tr><tr><td align="left"><code class="literal">RenderPictureType</code></td><td align="left"><code class="literal">RC_DRAWABLE</code></td><td align="left">The source drawable is passed as the parent for Render picture objects.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section" title="Device Access"><div class="titlepage"><div><div><h5 class="title"><a id="device_access_hook"></a>Device Access</h5></div></div></div><p>This hook allows security extensions to restrict client actions on input devices.  The hook argument is a pointer to a structure of type <span class="type">XaceDeviceAccessRec</span>.  This structure contains a
	  <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	  a <em class="structfield"><code>dev</code></em> field of type <span class="type">DeviceIntPtr</span>,
	  a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	  and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client attempting to access the device (keyboard).  Note that this may be <code class="varname">serverClient</code>.</p><p>The <em class="structfield"><code>dev</code></em> field refers to the input device being accessed.</p><p>The <em class="structfield"><code>access_mode</code></em> field encodes the type of action being performed.  The valid mode bits are described in the table below.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the device operation will fail and an error (usually, but not always, the status value) will be returned to the client.</p><div class="table"><a id="device_access_modes"></a><p class="title"><strong>Table 4. Device access hook access modes.</strong></p><div class="table-contents"><table summary="Device access hook access modes." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Access Mode Bit</th><th align="left">Meaning</th><th align="left">Example Call Site</th></tr></thead><tbody><tr><td align="left"><code class="literal">DixGetAttrAccess</code></td><td align="left">Attributes of the device are being queried.</td><td align="left">GetKeyboardMapping, XiGetKeyboardControl, XkbGetDeviceInfo</td></tr><tr><td align="left"><code class="literal">DixReadAccess</code></td><td align="left">The state of the device is being polled.</td><td align="left">QueryPointer, QueryKeymap, XkbGetState</td></tr><tr><td align="left"><code class="literal">DixWriteAccess</code></td><td align="left">The state of the device is being programatically manipulated.</td><td align="left">WarpPointer, XTestFakeInput, XiSendExtensionEvent</td></tr><tr><td align="left"><code class="literal">DixSetAttrAccess</code></td><td align="left">Per-client device configuration is being performed.</td><td align="left">XkbPerClientFlags</td></tr><tr><td align="left"><code class="literal">DixManageAccess</code></td><td align="left">Global device configuration is being performed.</td><td align="left">ChangeKeyboardMapping, XiChangeDeviceControl, XkbSetControls</td></tr><tr><td align="left"><code class="literal">DixUseAccess</code></td><td align="left">The device is being opened or referenced.</td><td align="left">XiOpenDevice, XkbSelectEvents</td></tr><tr><td align="left"><code class="literal">DixGrabAccess</code></td><td align="left">The device is being grabbed.</td><td align="left">GrabPointer, GrabButton, GrabKey</td></tr><tr><td align="left"><code class="literal">DixFreezeAccess</code></td><td align="left">The state of the device is being frozen by a synchronous grab.</td><td align="left">GrabKeyboard, GrabPointer</td></tr><tr><td align="left"><code class="literal">DixForceAccess</code></td><td align="left">The device cursor is being overriden by a grab.</td><td align="left">GrabPointer, GrabButton</td></tr><tr><td align="left"><code class="literal">DixGetFocusAccess</code></td><td align="left">The device focus is being retrieved.</td><td align="left">GetInputFocus, XiGetDeviceFocus</td></tr><tr><td align="left"><code class="literal">DixSetFocusAccess</code></td><td align="left">The device focus is being set.</td><td align="left">SetInputFocus, XiSetDeviceFocus</td></tr><tr><td align="left"><code class="literal">DixBellAccess</code></td><td align="left">The device bell is being rung.</td><td align="left">Bell, XiDeviceBell</td></tr><tr><td align="left"><code class="literal">DixCreateAccess</code></td><td align="left">The device object has been newly allocated.</td><td align="left">XIChangeDeviceHierarchy, XIAddMaster</td></tr><tr><td align="left"><code class="literal">DixDestroyAccess</code></td><td align="left">The device is being removed.</td><td align="left">XIChangeDeviceHierarchy, XIRemoveMaster</td></tr><tr><td align="left"><code class="literal">DixAddAccess</code></td><td align="left">A slave device is being attached to the device.</td><td align="left">XIChangeDeviceHierarchy, XIChangeAttachment</td></tr><tr><td align="left"><code class="literal">DixRemoveAccess</code></td><td align="left">A slave device is being unattached from the device.</td><td align="left">XIChangeDeviceHierarchy, XIChangeAttachment</td></tr><tr><td align="left"><code class="literal">DixListPropAccess</code></td><td align="left">Properties set on the device are being listed.</td><td align="left">ListDeviceProperties, XIListProperties</td></tr><tr><td align="left"><code class="literal">DixGetPropAccess</code></td><td align="left">A property set on the device is being read.</td><td align="left">GetDeviceProperty, XIGetProperty</td></tr><tr><td align="left"><code class="literal">DixSetPropAccess</code></td><td align="left">A property set on the device is being written.</td><td align="left">SetDeviceProperty, XISetProperty</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section" title="Property Access"><div class="titlepage"><div><div><h5 class="title"><a id="property_access_hook"></a>Property Access</h5></div></div></div><p>This hook allows security extensions to monitor all property accesses and additionally to support polyinstantiation if desired.  The hook argument is a pointer to a structure of type <span class="type">XacePropertyAccessRec</span>.  This structure contains a
	    <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	    a <em class="structfield"><code>pWin</code></em> field of type <span class="type">WindowPtr</span>,
	    a <em class="structfield"><code>ppProp</code></em> field of type <span class="type">PropertyPtr*</span>,
	    a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	    and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client which is accessing the property.  Note that this may be <code class="varname">serverClient</code> for server lookups.</p><p>The <em class="structfield"><code>pWin</code></em> field is the window on which the property is being accessed.</p><p>The <em class="structfield"><code>ppProp</code></em> field is a double-indirect pointer to the PropertyRec structure being accessed.  The extra level of indirection supports property polyinstantiation; see below.  If your extension does not use the polyinstantiation feature, simply dereference the pointer to obtain a <span class="type">PropertyPtr</span> for the property</p><p>The <em class="structfield"><code>access_mode</code></em> field encodes the type of action being performed.  The valid mode bits are described in the table below.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the property request will not be processed further and the error code will be returned to the client.  However, the <code class="literal">BadMatch</code> code has special meaning; see below.</p><div class="table"><a id="property_access_modes"></a><p class="title"><strong>Table 5. Property access hook mode bits.</strong></p><div class="table-contents"><table summary="Property access hook mode bits." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Access Mode Bit</th><th align="left">Meaning</th><th align="left">Example Call Site</th></tr></thead><tbody><tr><td align="left"><code class="literal">DixCreateAccess</code></td><td align="left">The property object has been newly allocated (this bit will always occur in conjunction with <code class="literal">DixWriteAccess</code>).</td><td align="left">ChangeProperty</td></tr><tr><td align="left"><code class="literal">DixWriteAccess</code></td><td align="left">The property data is being completely overwritten with new data.</td><td align="left">ChangeProperty, RotateProperties</td></tr><tr><td align="left"><code class="literal">DixBlendAccess</code></td><td align="left">The property data is being appended or prepended to.</td><td align="left">ChangeProperty</td></tr><tr><td align="left"><code class="literal">DixReadAccess</code></td><td align="left">The property data is being read.</td><td align="left">GetProperty</td></tr><tr><td align="left"><code class="literal">DixDestroyAccess</code></td><td align="left">The property data is being deleted.</td><td align="left">DeleteProperty</td></tr><tr><td align="left"><code class="literal">DixGetAttrAccess</code></td><td align="left">Existence of the property is being disclosed.</td><td align="left">ListProperties</td></tr><tr><td align="left"><code class="literal">DixPostAccess</code></td><td align="left">Post-write call reflecting new contents (this bit will always occur in conjunction with <code class="literal">DixWriteAccess</code>).</td><td align="left">ChangeProperty</td></tr></tbody></table></div></div><br class="table-break" /><p>New in XACE Version 2.0, this hook supports the polyinstantiation of properties.  This means that more than one property may exist having the same name, and the security extension can control which property object is seen by which client.  To perform property polyinstantiation, your security extension should take the following steps:
	    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>When a property is being created (<code class="literal">DixCreateAccess</code>), the security extension should label it appropriately based on the client that is creating it.  In this case, the <em class="structfield"><code>ppProp</code></em> field should not be modified.</p></li><li class="listitem"><p>When a property is being looked up, the <em class="structfield"><code>ppProp</code></em> field will refer to the first structure in the linked list with the given name.  The security extension may change the ppProp field to a different property structure by traversing the linked list (using the PropertyRec <em class="structfield"><code>next</code></em> field) to find an alternate structure with the same property name.</p></li><li class="listitem"><p>Alternately, when a property is being looked up, the <em class="structfield"><code>status</code></em> may be set to <code class="literal">BadMatch</code> which will cause the DIX layer to treat the property as not existing.  This may result in an additional property object with the same name being created (in which case the hook will be called again with the create access mode).</p></li></ul></div><p>
	  </p><p>New in XACE Version 2.2, this hook allows security extensions to verify the contents of properties after the client has written them.  On a property change, the property access hook will be called twice.  The first call is unchanged from previous versions.  The second call will have the <code class="literal">DixPostAccess</code> bit together with <code class="literal">DixWriteAccess</code> and the <em class="structfield"><code>ppProp</code></em> property pointer will contain the new data.  Setting the <em class="structfield"><code>status</code></em> field to something other than <code class="literal">Success</code> will cause the previous property contents to be restored and the client to receive the status code as an error.</p><p>Note that in the case of property creation (when <code class="literal">DixCreateAccess</code> is set), the <em class="structfield"><code>ppProp</code></em> field already reflects the new data.  Hence security extensions wishing to validate property data should check for either <code class="literal">DixPostAccess</code> or <code class="literal">DixCreateAccess</code> in conjunction with <code class="literal">DixWriteAccess</code>.  If your extension does not need this feature, simply ignore calls with the <code class="literal">DixPostAccess</code> bit set.</p></div><div class="section" title="Send Access"><div class="titlepage"><div><div><h5 class="title"><a id="send_access_hook"></a>Send Access</h5></div></div></div><p>This hook allows security extensions to prevent devices and clients from posting X events to a given window.  The hook argument is a pointer to a structure of type <span class="type">XaceSendAccessRec</span>.  This structure contains
	    a <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	    a <em class="structfield"><code>dev</code></em> field of type <span class="type">DeviceIntPtr</span>,
	    a <em class="structfield"><code>pWin</code></em> field of type <span class="type">WindowPtr</span>,
	    a <em class="structfield"><code>events</code></em> field of type <span class="type">events</span>,
	    a <em class="structfield"><code>count</code></em> field of type <span class="type">int</span>,
	    and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client attempting a <code class="literal">SendEvent</code> request or other synthetic event generation to the given window.  This field may be NULL if the <em class="structfield"><code>dev</code></em> field is set.</p><p>The <em class="structfield"><code>dev</code></em> field refers to the device attempting to post an event which would be delivered to the given window.  This field may be NULL if the <em class="structfield"><code>client</code></em> field is set.</p><p>The <em class="structfield"><code>pWin</code></em> field refers to the target window.</p><p>The <em class="structfield"><code>events</code></em> field refers to the events that are being sent.</p><p>The <em class="structfield"><code>count</code></em> field contains the number of events in the <em class="structfield"><code>events</code></em> array.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the events will be dropped on the floor instead of being delivered.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>This hook does not currently cover all instances of event delivery.</p></div></div><div class="section" title="Receive Access"><div class="titlepage"><div><div><h5 class="title"><a id="receive_access_hook"></a>Receive Access</h5></div></div></div><p>This hook allows security extensions to prevent a client from receiving X events that have been delivered to a given window.  The hook argument is a pointer to a structure of type <span class="type">XaceReceiveAccessRec</span>.  This structure contains
	    a <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	    a <em class="structfield"><code>pWin</code></em> field of type <span class="type">WindowPtr</span>,
	    a <em class="structfield"><code>events</code></em> field of type <span class="type">events</span>,
	    a <em class="structfield"><code>count</code></em> field of type <span class="type">int</span>,
	    and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client to which the event would be delivered.</p><p>The <em class="structfield"><code>pWin</code></em> field refers to the window where the event has been sent.</p><p>The <em class="structfield"><code>events</code></em> field refers to the events that are being sent.</p><p>The <em class="structfield"><code>count</code></em> field contains the number of events in the <em class="structfield"><code>events</code></em> array.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the events will not be delivered to the client.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>This hook does not currently cover all instances of event delivery.</p></div></div><div class="section" title="Client Access"><div class="titlepage"><div><div><h5 class="title"><a id="client_access_hook"></a>Client Access</h5></div></div></div><p>This hook allows security extensions to prevent clients from manipulating other clients directly.  This hook applies to a small set of protocol requests such as <code class="literal">KillClient</code>.  The hook argument is a pointer to a structure of type <span class="type">XaceClientAccessRec</span>.  This structure contains
	  a <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	  a <em class="structfield"><code>target</code></em> field of type <span class="type">ClientPtr</span>,
	  a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	  and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client making the request.</p><p>The <em class="structfield"><code>target</code></em> field refers to the client being manipulated.</p><p>The <em class="structfield"><code>access_mode</code></em> field encodes the type of action being performed.  The valid mode bits are described in the table below.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the request will fail and an error (usually, but not always, the status value) will be returned to the client.</p><div class="table"><a id="client_access_modes"></a><p class="title"><strong>Table 6. Client access hook mode bits.</strong></p><div class="table-contents"><table summary="Client access hook mode bits." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Access Mode Bit</th><th align="left">Meaning</th><th align="left">Example Call Site</th></tr></thead><tbody><tr><td align="left"><code class="literal">DixGetAttrAccess</code></td><td align="left">Attributes of the client are being queried.</td><td align="left">SyncGetPriority</td></tr><tr><td align="left"><code class="literal">DixSetAttrAccess</code></td><td align="left">Attributes of the client are being set.</td><td align="left">SyncSetPriority</td></tr><tr><td align="left"><code class="literal">DixManageAccess</code></td><td align="left">The client's close-down-mode (which affects global server resource management) is being set.</td><td align="left">SetCloseDownMode</td></tr><tr><td align="left"><code class="literal">DixDestroyAccess</code></td><td align="left">The client is being killed.</td><td align="left">KillClient</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section" title="Extension Access"><div class="titlepage"><div><div><h5 class="title"><a id="ext_access_hook"></a>Extension Access</h5></div></div></div><p>This hook allows security extensions to approve or deny requests involving which extensions are supported by the server.  This allows control over which extensions are visible.  The hook argument is a pointer to a structure of type <span class="type">XaceExtAccessRec</span>.  This structure contains a
	  <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	  a <em class="structfield"><code>ext</code></em> field of type <span class="type">ExtensionEntry*</span>,
	  a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	  and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client making the incoming request, which is typically <code class="literal">QueryExtension</code> or <code class="literal">ListExtensions</code>.</p><p>The <em class="structfield"><code>ext</code></em> field refers to the extension being accessed.  This is required information since extensions are not associated with any particular major number.</p><p>The <em class="structfield"><code>access_mode</code></em> field is set to <code class="literal">DixGetAttrAccess</code> when this hook is exercised.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the extension will be reported as not supported (<code class="literal">QueryExtensions</code>) or omitted from the returned list (<code class="literal">ListExtensions</code>).</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>If this hook is used, an extension dispatch hook should also be installed to make sure that clients cannot circumvent the check by guessing the major opcodes of extensions.</p></div></div><div class="section" title="Server Access"><div class="titlepage"><div><div><h5 class="title"><a id="server_access_hook"></a>Server Access</h5></div></div></div><p>This hook allows security extensions to approve or deny requests that affect the X server itself.  The hook argument is a pointer to a structure of type <span class="type">XaceServerAccessRec</span>, which contains
	  a <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	  a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	  and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client making the request.</p><p>The <em class="structfield"><code>access_mode</code></em> field encodes the type of action being performed.  The valid mode bits are described in the table below.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the request will fail and an error (usually, but not always, the status value) will be returned to the client.</p><div class="table"><a id="server_access_modes"></a><p class="title"><strong>Table 7. Server access hook mode bits.</strong></p><div class="table-contents"><table summary="Server access hook mode bits." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Access Mode Bit</th><th align="left">Meaning</th><th align="left">Example Call Site</th></tr></thead><tbody><tr><td align="left"><code class="literal">DixGetAttrAccess</code></td><td align="left">Attributes of the server are being queried.</td><td align="left">GetFontPath</td></tr><tr><td align="left"><code class="literal">DixSetAttrAccess</code></td><td align="left">Attributes of the server are being set.</td><td align="left">SetFontPath</td></tr><tr><td align="left"><code class="literal">DixManageAccess</code></td><td align="left">Server management is being performed.</td><td align="left">ChangeAccessControl, ListHosts</td></tr><tr><td align="left"><code class="literal">DixGrabAccess</code></td><td align="left">A server grab is being performed.</td><td align="left">GrabServer</td></tr><tr><td align="left"><code class="literal">DixReadAccess</code></td><td align="left">The server's actions are being recorded.</td><td align="left">Record, XEVIE extensions</td></tr><tr><td align="left"><code class="literal">DixDebugAccess</code></td><td align="left">Server debug facilities are being used.</td><td align="left">XTest extension, XkbSetDebuggingFlags</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section" title="Selection Access"><div class="titlepage"><div><div><h5 class="title"><a id="selection_access_hook"></a>Selection Access</h5></div></div></div><p>This hook allows security extensions to monitor all selection accesses and additionally to support polyinstantiation if desired.  The hook argument is a pointer to a structure of type <span class="type">XaceSelectionAccessRec</span>.  This structure contains a
	    <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	    a <em class="structfield"><code>ppSel</code></em> field of type <span class="type">Selection**</span>,
	    a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	    and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client which is accessing the property.  Note that this may be <code class="varname">serverClient</code> for server lookups.</p><p>The <em class="structfield"><code>ppSel</code></em> field is a double-indirect pointer to the Selection structure being accessed.  The extra level of indirection supports selection polyinstantiation; see below.  If your extension does not use the polyinstantiation feature, simply dereference the pointer to obtain a <span class="type">SelectionRec *</span> for the selection.</p><p>The <em class="structfield"><code>access_mode</code></em> field encodes the type of action being performed.  The valid mode bits are described in the table below.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the property request will not be processed further and the error code will be returned to the client.  However, the <code class="literal">BadMatch</code> code has special meaning; see below.</p><div class="table"><a id="selection_access_modes"></a><p class="title"><strong>Table 8. Selection access hook mode bits.</strong></p><div class="table-contents"><table summary="Selection access hook mode bits." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Access Mode Bit</th><th align="left">Meaning</th><th align="left">Example Call Site</th></tr></thead><tbody><tr><td align="left"><code class="literal">DixCreateAccess</code></td><td align="left">The selection object has been newly allocated (this bit will always occur in conjunction with <code class="literal">DixSetAttrAccess</code>).</td><td align="left">SetSelectionOwner</td></tr><tr><td align="left"><code class="literal">DixSetAttrAccess</code></td><td align="left">The selection owner is being set.</td><td align="left">SetSelectionOwner</td></tr><tr><td align="left"><code class="literal">DixGetAttrAccess</code></td><td align="left">The selection owner is being queried.</td><td align="left">GetSelectionOwner</td></tr><tr><td align="left"><code class="literal">DixReadAccess</code></td><td align="left">A convert operation is being requested on the selection.</td><td align="left">ConvertSelection</td></tr></tbody></table></div></div><br class="table-break" /><p>This hook supports the polyinstantiation of selections.  This means that more than one selection may exist having the same name, and the security extension can control which selection object is seen by which client.  To perform selection polyinstantiation, your security extension should take the following steps:
	    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>When selection ownership is being established (<code class="literal">DixSetAttrAccess</code>), the security extension should label it appropriately based on the client that is taking ownership.  In this case, the <em class="structfield"><code>ppSel</code></em> field should not be modified.</p></li><li class="listitem"><p>When a selection is being looked up, the <em class="structfield"><code>ppProp</code></em> field will refer to the first structure in the linked list with the given name.  The security extension may change the ppSel field to a different selection structure by traversing the linked list (using the Selection <em class="structfield"><code>next</code></em> field) to find an alternate structure with the same selection name.</p></li><li class="listitem"><p>Alternately, when a selection is being looked up, the <em class="structfield"><code>status</code></em> may be set to <code class="literal">BadMatch</code> which will cause the DIX layer to treat the selection as not existing.  This may result in an additional selection object with the same name being created (in which case the hook will be called again with the create access mode).</p></li></ul></div><p>
	  </p></div><div class="section" title="Screen Access"><div class="titlepage"><div><div><h5 class="title"><a id="screen_access_hook"></a>Screen Access</h5></div></div></div><p>This hook allows security extensions to approve or deny requests that manipulate screen objects  The hook argument is a pointer to a structure of type <span class="type">XaceScreenAccessRec</span>.  This structure contains a
	    <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	    a <em class="structfield"><code>screen</code></em> field of type <span class="type">ScreenPtr</span>,
	    a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	    and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client making the request.</p><p>The <em class="structfield"><code>screen</code></em> field refers to the screen object being referenced.</p><p>The <em class="structfield"><code>access_mode</code></em> field encodes the type of action being performed.  The valid mode bits are described in the table below.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the request will not be processed further and the error code will be returned to the client.</p><div class="table"><a id="screen_access_modes"></a><p class="title"><strong>Table 9. Screen access hook mode bits.</strong></p><div class="table-contents"><table summary="Screen access hook mode bits." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Access Mode Bit</th><th align="left">Meaning</th><th align="left">Example Call Site</th></tr></thead><tbody><tr><td align="left"><code class="literal">DixGetAttrAccess</code></td><td align="left">Attributes of the screen object are being queried.</td><td align="left">ListInstalledColormaps, QueryBestSize</td></tr><tr><td align="left"><code class="literal">DixSetAttrAccess</code></td><td align="left">Attributes of the screen object are being set.</td><td align="left">InstallColormap</td></tr><tr><td align="left"><code class="literal">DixHideAccess</code></td><td align="left">The cursor on the screen is being globally hidden.</td><td align="left">XFixesHideCursor</td></tr><tr><td align="left"><code class="literal">DixShowAccess</code></td><td align="left">The cursor on the screen is being globally unhidden.</td><td align="left">XFixesShowCursor</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section" title="Screen Saver Access"><div class="titlepage"><div><div><h5 class="title"><a id="screensaver_access_hook"></a>Screen Saver Access</h5></div></div></div><p>This hook allows security extensions to approve or deny requests that manipulate the screensaver.   The hook argument is a pointer to a structure of type <span class="type">XaceScreenAccessRec</span>.  This structure contains a
	    <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	    a <em class="structfield"><code>screen</code></em> field of type <span class="type">ScreenPtr</span>,
	    a <em class="structfield"><code>access_mode</code></em> field of type <span class="type">Mask</span>,
	    and a <em class="structfield"><code>status</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the client making the request.</p><p>The <em class="structfield"><code>screen</code></em> field refers to the screen object being referenced.</p><p>The <em class="structfield"><code>access_mode</code></em> field encodes the type of action being performed.  The valid mode bits are described in the table below.</p><p>The <em class="structfield"><code>status</code></em> field may be set to a nonzero X protocol error code.  In this event, the request will not be processed further and the error code will be returned to the client.</p><div class="table"><a id="screensaver_access_modes"></a><p class="title"><strong>Table 10. Screen saver access hook mode bits.</strong></p><div class="table-contents"><table summary="Screen saver access hook mode bits." border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Access Mode Bit</th><th align="left">Meaning</th><th align="left">Example Call Site</th></tr></thead><tbody><tr><td align="left"><code class="literal">DixGetAttrAccess</code></td><td align="left">Attributes of the screen saver are being queried.</td><td align="left">GetScreenSaver, ScreenSaverQueryInfo</td></tr><tr><td align="left"><code class="literal">DixSetAttrAccess</code></td><td align="left">Attributes of the screen saver are being set.</td><td align="left">SetScreenSaver, ScreenSaverSelectInput</td></tr><tr><td align="left"><code class="literal">DixHideAccess</code></td><td align="left">The screen saver is being programmatically activated.</td><td align="left">ForceScreenSaver, DPMSEnable</td></tr><tr><td align="left"><code class="literal">DixShowAccess</code></td><td align="left">The screen saver is being programmatically deactivated.</td><td align="left">ForceScreenSaver, DPMSDisable</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section" title="Authorization Availability Hook"><div class="titlepage"><div><div><h5 class="title"><a id="auth_avail_hook"></a>Authorization Availability Hook</h5></div></div></div><p>This hook allows security extensions to examine the authorization associated with a newly connected client.  This can be used to set up client security state depending on the authorization method that was used.  The hook argument is a pointer to a structure of type <span class="type">XaceAuthAvailRec</span>.  This structure contains a
	  <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	  and a <em class="structfield"><code>authId</code></em> field of type <span class="type">XID</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to the newly connected client.</p><p>The <em class="structfield"><code>authId</code></em> field is the resource ID of the client's authorization.</p><p>This hook has no return value.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This hook is called after the client enters the initial state and before the client enters the running state.  Keep this in mind if your security extension uses the <code class="varname">ClientStateCallback</code> list to keep track of clients.</p><p>This hook is a legacy of the APPGROUP Extension.  In the future, this hook may be phased out in favor of a new client state, <code class="literal">ClientStateAuthenticated</code>.</p></div></div><div class="section" title="Keypress Availability Hook"><div class="titlepage"><div><div><h5 class="title"><a id="key_avail_hook"></a>Keypress Availability Hook</h5></div></div></div><p>This hook allows security extensions to examine keypresses outside of the normal event mechanism.  This could be used to implement server-side hotkey support.  The hook argument is a pointer to a structure of type <span class="type">XaceKeyAvailRec</span>.  This structure contains a
	  <em class="structfield"><code>event</code></em> field of type <span class="type">xEventPtr</span>,
	  a <em class="structfield"><code>keybd</code></em> field of type <span class="type">DeviceIntPtr</span>,
	  and a <em class="structfield"><code>count</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>event</code></em> field refers to the keyboard event, typically a <code class="literal">KeyPress</code> or <code class="literal">KeyRelease</code>.</p><p>The <em class="structfield"><code>keybd</code></em> field refers to the input device that generated the event.</p><p>The <em class="structfield"><code>count</code></em> field is the number of repetitions of the event (not 100\% sure of this at present, however).</p><p>This hook has no return value.</p></div><div class="section" title="Auditing Hooks"><div class="titlepage"><div><div><h5 class="title"><a id="audit_avail_hook"></a>Auditing Hooks</h5></div></div></div><p>Two hooks provide basic auditing support.  The begin hook is called immediately before an incoming client request is dispatched and before the dispatch hook is called (refer to <a class="xref" href="#core_dispatch_hook" title="Core Dispatch">the section called “Core Dispatch”</a>).  The end hook is called immedately after the processing of the request has finished.  The hook argument is a pointer to a structure of type <span class="type">XaceKeyAvailRec</span>.  This structure contains a
	  <em class="structfield"><code>client</code></em> field of type <span class="type">ClientPtr</span>,
	  and a <em class="structfield"><code>requestResult</code></em> field of type <span class="type">int</span>.</p><p>The <em class="structfield"><code>client</code></em> field refers to client making the request.</p><p>The <em class="structfield"><code>requestResult</code></em> field contains the result of the request, either <code class="literal">Success</code> or one of the protocol error codes.  Note that this field is significant only in the end hook.</p><p>These hooks have no return value.</p></div></div></div></div><div class="section" title="Protocol"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2686064"></a>Protocol</h2></div></div></div><div class="section" title="Requests"><div class="titlepage"><div><div><h3 class="title"><a id="id2686070"></a>Requests</h3></div></div></div><p>XACE does not define any X protocol.</p></div><div class="section" title="Events"><div class="titlepage"><div><div><h3 class="title"><a id="id2686080"></a>Events</h3></div></div></div><p>XACE does not define any X protocol.</p></div><div class="section" title="Errors"><div class="titlepage"><div><div><h3 class="title"><a id="id2686091"></a>Errors</h3></div></div></div><p>XACE does not define any X protocol.</p></div></div></div></body></html>
